---
title: "Birth Data Report"
author: "Allison Young"
date: "September 22, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Setup and Load Analysis Functions
Load libraries and functions I've created to help with basic data analysis and dataset preview

```{r, include=FALSE}
#Load libraries
library(readr)
library(ggplot2)
library(lattice)
library(lubridate)
#install.packages("openxlsx")
library(openxlsx)

# Load Functions
setwd("C:/Users/ayoung/Desktop/Duke/Git Repositories/Modeling-IDS-702/Functions")
source("loadfile.R")
source("exploredata.R")
source("pullfname.R")
source("textsummary.R")
```

### Load Data Files (INSERT FILE NAMES HERE)
```{r}

#Load Data

dir <- "C:/Users/ayoung/Desktop/Duke/Git Repositories/Modeling-IDS-702/"  ### INSERT
folder = "Birth Data Analysis"  ### INSERT
file = "smoking.csv" ### INSERT

births <- loadfile(dir,folder,file)


```

### Printed Summary of File

```{r}
textsummary(births)
```

### Explore Data (Ctrl+F and Replace file names for rest of analysis)

```{r}
exploredata(births)

```

### Predictor Variable Transformations and Labeling

```{r}
##Birthweight (continuous, leave as cont, but maybe also do LBW catigorization if time)
births$bwt <- births$`bwt.oz`  #make name easier to use

## Date of Birth (date as a number, convert to date)
births$dateMod <- convertToDate(births$date)

# Mother Race (Categorical, needed to condense number of categoires)
births$mracetxt[births$mrace== 0] <- "White"
births$mracetxt[births$mrace== 1] <- "White"
births$mracetxt[births$mrace== 2] <- "White"
births$mracetxt[births$mrace== 3] <- "White"
births$mracetxt[births$mrace== 4] <- "White"
births$mracetxt[births$mrace== 5] <- "White"
births$mracetxt[births$mrace== 6] <- "Mexican"
births$mracetxt[births$mrace== 7] <- "Black"
births$mracetxt[births$mrace== 8] <- "Asian"
births$mracetxt[births$mrace== 9] <- "Mix"
births$mracetxt[births$mrace== 99] <- NA

births_plotRace <- ggplot(data = births) + geom_bar(mapping = aes(x=mracetxt))

births_plotRace

#Smoking Status (Boolean, Primary Predictor)
births$smoketxt[births$smoke== 0] <- "Non-Smoker"
births$smoketxt[births$smoke== 1] <- "Smoker"

births_plotSmoke <- ggplot(data = births) + geom_bar(mapping = aes(x=smoketxt))
births_plotSmoke

#Parity (Continuous, test if linear assoc relevant to model)
births_plotParity <- hist(births$parity)
ordered(unique(births$parity))
#Levels: 0 < 1 < 2 < 3 < 4 < 5 < 6 < 7 < 8 < 9 < 10 < 11

births_plotParity

#Mother's Age (Continuous, could group into teen/non, or linear assoc)
# Should mean center
births_plotMAge <- hist(births$mage)
#ordered(unique(births$mage))
#Levels: 15 < 17 < 18 < 19 < 20 < 21 < 22 < 23 < 24 < 25 < 26 < 27 < 28 < 29 < ... < 45
births$mageCent <- births$mage- mean(births$mage)

births_plotMAge

#Mother's Education (Categorical, check linear association (or Factor in few groups))
births_plotMEd <- hist(births$med)
ordered(unique(births$med))
#Levels: 0 < 1 < 2 < 3 < 4 < 5 < 7
births$medtxt[births$med== 0] <- "Less than 8th Grade"
births$medtxt[births$med== 1] <- "8th to 12th, No Grad"
births$medtxt[births$med== 2] <- "HS Grad Only"
births$medtxt[births$med== 3] <- "HS Grad and Trade"
births$medtxt[births$med== 4] <- "HS Grade and Some College"
births$medtxt[births$med== 5] <- "College Grad"
births$medtxt[births$med== 6] <- "Trade School (HSG Unknown)"
births$medtxt[births$med== 7] <- "Trade School (HSG Unknown)"

births_plotMEd

#Mother's Height (Continuous, test if relevant to model)
births_plotMHt <- hist(births$mht)
ordered(unique(births$mht))
#Levels: 0 < 1 < 2 < 3 < 4 < 5 < 7
births$mhtCent <- births$mht- mean(births$mht)

births_plotMHt

#Mother's Weight (Continuous, test if relevant to model)
births_plotMpregWt <- hist(births$mpregwt)
ordered(unique(births$mpregwt))
births$mpregwtCent <- births$mpregwt- mean(births$mpregwt)

births_plotMpregWt

#Monther's Income (categorical, group into 3 or so categories based on linear analysis)
births_plotInc <- hist(births$inc)
ordered(unique(births$inc))
#Levels: 0 < 1 < 2 < 3 < 4 < 5 < 6 < 7 < 8 < 9

births$inctxt[births$inc== 0] <- "Under 2500"
births$inctxt[births$inc== 1] <- "2500-4999"
births$inctxt[births$inc== 2] <- "5000-7499"
births$inctxt[births$inc== 3] <- "7500-9999"
births$inctxt[births$inc== 4] <- "10000-12499"
births$inctxt[births$inc== 5] <- "12500-14999"
births$inctxt[births$inc== 6] <- "15000-17499"
births$inctxt[births$inc== 7] <- "17500-19999"
births$inctxt[births$inc== 8] <- "20000-22499"
births$inctxt[births$inc== 9] <- "22500+"

births_plotInc

##Check Added Variables
head(births$bwt)
head(births$smoketxt)
head(births$medtxt)
head(births$dateMod)
head(births$mageCent)
head(births$mhtCent)
head(births$mpregwtCent)

```

## Outcome Variable and Initial Factorization
```{r}
#Smoking Status
#sample size
n = nrow(births)

#create series of indicator variables for smoking status
births$smokeY = rep(0, n)
births$smokeY[births$smoketxt == "Smoker"] = 1

births$smokeN = rep(0, n)
births$smokeN[births$smoketxt == "Non-Smoker"] = 1


#create series of indicator variables for mother's race
births$mracetxtW = rep(0, n)
births$mracetxtW[births$mracetxt == "White"] = 1

births$mracetxtB = rep(0, n)
births$mracetxtB[births$mracetxt == "Black"] = 1

births$mracetxtA = rep(0, n)
births$mracetxtA[births$mracetxt == "Asian"] = 1

births$mracetxtME = rep(0, n)
births$mracetxtME[births$mracetxt == "Mexican"] = 1

births$mracetxtMI = rep(0, n)
births$mracetxtMI[births$mracetxt == "Mix"] = 1
```

## Initial Modeling

```{r}
boxplot(bwt~smoke, data=births) #Clearly there is an association, now add other variables

plot(lm(bwt~ smokeN + mracetxtB+ mracetxtA+ mracetxtMI +mracetxtME +parity, data = births))

#Model 1
Mod1 = lm(bwt~ smokeN + mracetxtB+ mracetxtA+ mracetxtMI +mracetxtME +parity, data = births)
plot(y=Mod1$residuals, x=births$smokeN)
plot(y=Mod1$residuals, x=births$mracetxt)
abline(0,0)
          


```


## Examine Relationships

```{r}
plot(bwt~smoketxt+dateMod+mageCent+mhtCent+mpregwtCent+mracetxt+medtxt+inctxt, data=births)

firstModel <- lm(bwt~dateMod+mageCent+mhtCent+mpregwtCent+mracetxt+medtxt+inctxt,data=births)

plot(firstModel$residuals,births$dateMod)
plot(firstModel$residuals,births$mageCent)
plot(firstModel$residuals,births$mhtCent)
plot(firstModel$residuals,births$mpregwtCent)
plot(firstModel$residuals,births$mracetxt)
plot(firstModel$residuals,births$medtxt)
plot(firstModel$residuals,births$inctxt)

```


## Factorization
```{r, fig1,fig.height = 15, fig.width = 10, fig.align = "center" }



```

```{r fig2, fig.height = 15, fig.width = 10, fig.align = "center"}
ggplot(data = births) + 
  geom_point(mapping = aes(x = med, y = bwt, color=smoke), position = "jitter") + facet_wrap(~ mracetxt, nrow = 4)

```

```{r}
fit1 <- lm(Sepal.Length ~ Petal.Width, data = iris)
summary(fit1)

plot(Sepal.Length ~ Petal.Width, data = iris)
abline(fit1)
```

